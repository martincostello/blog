<!doctype html><html lang=en-gb><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><title>ASP.NET Core 2.1 â€“ Supercharging Our Applications ðŸš€ | The blog of a software developer and tester.</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="author" content="Martin Costello"><meta name=copyright content="&copy; Martin Costello 2014-2025"><meta name=description content="Upgrading to ASP.NET Core 2.1 can deliver serious performance improvements to your web applications as well as make you much more productive as a developer."><meta name=language content="en"><meta name=theme-color content="#ffffff"><meta name=keywords content="dotnet,aspnetcore,performance"><meta name=robots content="INDEX"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="article:author" content="10100867762061905"><meta property="article:published_time" content="2018-06-14T00:00:00Z"><meta property="article:modified_time" content="2018-06-14T00:00:00Z"><meta property="article:tag" content="dotnet,aspnetcore,performance"><meta property="fb:profile_id" content="10100867762061905"><meta name=application-name content="Martin Costello's Blog"><meta name=msapplication-config content="browserconfig.xml"><meta name=msapplication-navbutton-color content="#0095DA"><meta name=msapplication-starturl content="/"><meta property="og:description" content="Upgrading to ASP.NET Core 2.1 can deliver serious performance improvements to your web applications as well as make you much more productive as a developer."><meta property="og:image" content="https://cdn.martincostello.com/blog_web-cpu.png"><meta property="og:locale" content="en_GB"><meta property="og:site_name" content="Martin Costello's Blog"><meta property="og:title" content="ASP.NET Core 2.1 â€“ Supercharging Our Applications ðŸš€"><meta property="og:type" content="article"><meta property="og:updated_time" content="2018-06-14T00:00:00Z"><meta property="og:url" content="https://blog.martincostello.com/asp.net-core-2.1-supercharging-our-applications/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@martin_costello"><meta name=twitter:description content="Upgrading to ASP.NET Core 2.1 can deliver serious performance improvements to your web applications as well as make you much more productive as a developer."><meta name=twitter:domain content="blog.martincostello.com"><meta name=twitter:image content="https://cdn.martincostello.com/blog_web-cpu.png"><meta name=twitter:image:alt content="Martin Costello"><meta name=twitter:site content="@martin_costello"><meta name=twitter:title content="ASP.NET Core 2.1 â€“ Supercharging Our Applications ðŸš€"><meta name=twitter:url content="https://blog.martincostello.com/asp.net-core-2.1-supercharging-our-applications/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Martin Costello"><meta name=google-site-verification content="ji6SNsPQEbNQmF252sQgQFswh-b6cDnNOa3AHvgo4J0"><meta name=msvalidate.01 content="D6C2E7551C902F1A396D8564C6452930"><link rel=canonical href=https://blog.martincostello.com/asp.net-core-2.1-supercharging-our-applications/><link rel=manifest href=/manifest.webmanifest><link href=https://cdn.martincostello.com/favicon.ico rel="shortcut icon" type=image/x-icon><link href=/sitemap.xml rel=sitemap type=application/xml><link href=/feed.xml rel=alternate type=application/rss+xml title=Atom></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container><a href=/ class=navbar-brand><span class="fa-solid fa-laptop-code" aria-hidden=true></span>
blog.martincostello.com
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#site-navbar aria-controls=site-navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=site-navbar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/archive/ title="View the post archive">Archive
<span class="fa-solid fa-box-archive" aria-hidden=true></span></a></li></ul><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-me/ title="About Martin">About Me
<span class="fa-solid fa-circle-info" aria-hidden=true></span></a></li></ul></div></div></nav><main class="container body-content"><div class="p-4 mb-3 bg-light rounded-3"><div class="container-fluid py-3"><h1 class=display-5>ASP.NET Core 2.1 â€“ Supercharging Our Applications ðŸš€</h1><p class="col-md-8 fs-4 lead">Upgrading to ASP.NET Core 2.1 can deliver serious performance improvements to your web applications as well as make you much more productive as a developer.</p></div></div><p><div class="row d-none d-md-block"><div class=col-6>14 June 2018 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a> |
<a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></div></div><div class="row d-md-none"><div class=col-12>14 June 2018 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a></div><div class=col-12><a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></p></div></div></p><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=ASP.NET+Core+2.1+%E2%80%93+Supercharging+Our+Applications+%F0%9F%9A%80+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fasp.net-core-2.1-supercharging-our-applications%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><blockquote><p><em>This blog post was originally published by me on the <a href=https://web.archive.org/web/20240422072816/https://tech.justeattakeaway.com/2018/06/14/aspnet-core-21-supercharging-our-applications/>Just Eat Tech blog</a>.</em></p></blockquote><h2 id=introduction>Introduction</h2><p><a href=https://devblogs.microsoft.com/dotnet/asp-net-core-2-1-0-now-available/>ASP.NET Core 2.1</a> was released by Microsoft at the end of May, and last week we deployed
two consumer-facing applications upgraded to use ASP.NET Core 2.1 to production for the first time.</p><p>These applications have now been run in production for an entire weekend of peak traffic, and weâ€™ve seen
some great performance improvements â€“ in some cases <strong>improving average response times by over 40%</strong>.</p><p>READMORE</p><h2 id=background>Background</h2><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_aspnet-core-releases.png alt="ASP.NET Core release timeline" title="ASP.NET Core release timeline"></p><p>.NET Core 1.0 was released almost 2 years ago now, <a href=https://devblogs.microsoft.com/dotnet/announcing-net-core-1-0/>in June 2016</a>, and weâ€™ve been using it
in some form or another at Just Eat ever since. Early adoption was rather limited amongst our teams, mainly
due to the fact that .NET Standard support had not yet filtered through to many of the third-party dependencies
we use to build our applications, such as the AWS SDK and NUnit, coupled with some APIs that are available in
the full .NET Framework not being available in the first release.</p><p>.NET Core 2.0 was subsequently <a href=https://devblogs.microsoft.com/dotnet/announcing-net-core-2-0/>released in August last year</a>, adding many more APIs and
features, plus applying feedback Microsoft received since the first release from user feedback for real-world
application use-cases.</p><p>Since the release of .NET Core 2.0, more and more teams here at Just Eat have been adopting .NET Core for new
projects, plus a small number of refactors and/or rewrites of existing applications. At the time of writing, we
have over 40 different applications (we call these <em>features</em> here at Just Eat) running in our production environments.</p><p>In fact, our internal Just Eat technology radar has recently moved .NET Core from a <em>Trial</em> technology to an <em>Adopt</em> technology.</p><h2 id=upgrades>Upgrades</h2><p>Since the [first preview of .NET Core 2.1]p<a href=https://devblogs.microsoft.com/dotnet/announcing-net-core-2-1-preview-1/>dotnet-core-21-preview-1</a> was made available in February, the team
I work in had been maintaining a branch of two of our ASP.NET Core 2.0 features. One is a consumer-facing MVC
web application that serves HTML pages using Razor, and the other is an MVC API application that acts as an
orchestration layer between that web application and a number of our lower-level internal APIs, all of which
run on .NET Framework 4.6.x.</p><p>A simple illustration of how these applications fit together in our architecture is shown below.</p><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_aws-network.png alt="Application architecture" title="Application architecture"></p><p>From Previews 1 and 2 to Release Candidate 1, we experimented with various new features and capabilities, as
well as finding a few <a href=https://github.com/dotnet/sdk/issues/9367>bugs</a>, <a href=https://github.com/aspnet/Mvc/issues/7635>feature gaps</a> and other changes along the way.</p><p>While upgrading from 2.0 to 2.1 is relatively simple if you just follow the <a href=https://learn.microsoft.com/aspnet/core/migration/20_21>migration guide</a>, some
of the more interesting additions in .NET Core 2.1 require additional development effort to leverage in your existing
application.</p><p>One new feature we found particularly interesting was <a href=https://github.com/aspnet/HttpClientFactory>HttpClientFactory</a>. Given that both
applications perform many HTTP requests as part of their daily operations, particularly the orchestration API, we
felt that using the factory and the underlying <code>HttpClient</code> changes to use a managed Sockets implementation would
give us some good performance improvements.</p><p>Another was the new <a href=https://www.hanselman.com/blog/easier-functional-and-integration-testing-of-aspnet-core-applications><code>WebApplicationFactory&lt;T></code></a> class, which allowed us to delete lots of
boilerplate code in our test suite and make our integration tests faster and easier to set up. Overall the Git
patches for the two applications to go from 2.0 to 2.1 were <code>+199/âˆ’194</code> lines for the web application, and
<code>+246/âˆ’297</code> lines for the API.</p><p>Once the final ASP.NET 2.1 release was available (it was even released a <a href=https://github.com/dotnet/aspnetcore/wiki/2.1.0-Early-Access-Downloads/e8f44a2b58299a1bc500b51baca5afb8d696f0f0>few days early</a>
with some caveats) and we updated our Amazon Machine Image to have the ASP.NET Core 2.1 Runtime pre-installed, we
were ready to deploy the upgrade.</p><p>First we deployed the 2.1 build of the API to production as a canary (serving a small percentage of traffic) on
Monday 4th June and eagerly awaited the outcome. The morning after showed no errors or degraded performance, so
we promoted the canary to 100% of traffic for that feature on the Tuesday morning. Once that was done, we deployed
the 2.1 build of the web application to production for another over overnight canary. Again, no detriment was seen
in our logs and monitoring, so we promoted that to 100% of user traffic on the morning of the 6th June.</p><p>At Just Eat our busiest times for traffic are typically in the evenings, particularly at the weekend, so the real
litmus test for the new versions of both applications targeting ASP.NET Core 2.1 would be their first weekend serving
requests to hungry users of our UK consumer website.</p><p>On Monday 11th June I came into the office eager to pore over the results of the weekendsâ€™ traffic, and I was not
disappointed with the results at all!</p><h2 id=show-me-the-numbers>Show Me The Numbers</h2><p>The comparisons below are for both applications running ASP.NET Core 2.1 on Sunday 10/06/18 compared to the previous
Sunday (03/06/18) where it was running ASP.NET Core 2.0. Sunday was chosen as the basis for comparison (rather than
Friday or Saturday) as traffic levels from users was the most similar week-to-week.</p><p>The response statistics were collected using <a href=https://github.com/justeattakeaway/JustEat.StatsD>statsd</a> from either a middleware or <code>HttpMessageHandler</code> depending
on the context, which are pushed to Graphite and then visualised with Grafana.</p><p>CPU statistics are collected separately on our AWS EC2 instances and also pushed to Graphite.</p><h3 id=api>API</h3><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_api-response-times.png alt="Response times from the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="Response times from the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>The API averaged <code>107ms</code> per HTTP GET compared to <code>141ms</code> (<strong>approximately a 24% improvement</strong>), with much less deviation.</p><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_api-requests.png alt="Request rate to the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="Request rate to the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>The overall request rate also is shown to give an indication of the relative load on the API.</p><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_api-cpu.png alt="CPU utilisation of the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="CPU utilisation of the API between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>CPU usage is also illustrated, which again shows a slight overall improvement. The spike in the graph is where auto-scaling
increased the number of EC2 instances in service based on average CPU load.</p><h3 id=web>Web</h3><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_web-response-times.png alt="Response times from the web application between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="Response times from the web application between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>The web app averaged <code>130ms</code> per page render compared to <code>230ms</code> (<strong>approximately a 43% improvement</strong>) which again shows
much less deviation.</p><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_web-requests.png alt="Request rate to the web application between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="Request rate to the web application between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>The overall request rate also is shown to give an indication of the relative load on the web application.</p><p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_web-cpu.png alt="CPU utilisation of the website between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift." title="CPU utilisation of the website between 16:30 and 22:30 on 10/06/18 with a -7 day timeshift."></p><p>CPU usage is also illustrated, which again shows a slight overall improvement. The spikes in the graph is where auto-scaling
increased the number of EC2 instances in service based on average CPU load.</p><p>Scaling occurs later than the previous week as the application instances are now able to handle more load per-box
for the same average CPU usage. This gives an additional benefit beyond performance, as it can reduce the overall
cost of running the application as the total provisioned CPU required for like-for-like load means that less EC2
instances are required.</p><p>The second spike on the CPU graph is caused by raised CPU as the application is installed onto the new EC2 instances coming
into service, which skews the CPU average temporarily.</p><h2 id=conclusion>Conclusion</h2><p>The performance improvements made by Microsoft and the Open Source community in ASP.NET Core and the Core CLR are
non-trivial. With minimal code changes you can super-charge your existing ASP.NET Core 2.0 applications by upgrading
to ASP.NET Core 2.1. This can reduce your response times to make your usersâ€™ experience better, and reduce your CPU
utilisation to help make your hosting bills lower too!</p><hr><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=ASP.NET+Core+2.1+%E2%80%93+Supercharging+Our+Applications+%F0%9F%9A%80+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fasp.net-core-2.1-supercharging-our-applications%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><hr><footer><p><div class=row><div class="d-none d-md-block col">&copy; Martin Costello 2014-2025 |
Built from <a href=https://github.com/martincostello/blog/commit/4116b929c2636f9c037d8c2a6c02e0a2140cd9fc rel=noopener title="View commit 4116b929c2636f9c037d8c2a6c02e0a2140cd9fc on GitHub">4116b92</a> on <a href=https://github.com/martincostello/blog/tree/copilot/fix-244 rel=noopener title="View branch copilot/fix-244 on GitHub">copilot/fix-244</a></div><div class=d-md-none><div class=col>&copy; Martin Costello 2014-2025</div></div></div></p></footer></main><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.7/flatly/bootstrap.min.css integrity="sha512-O+EA0Agf5+pB8u7CtnIAYq/BKyFPMT8c0DFjmqLyfIJJ9Fm8GBohV/0H0TFaZ96+jieN8zUVY4IkSBso9z6hpg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=/styles/site.css><script src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js integrity="sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src="https://www.googletagmanager.com/gtag/js?id=G-XJFV74HRL6" async></script><script>window.hugoSiteParams={render_analytics:!0,analytics_id:"G-XJFV74HRL6"}</script><script src=/scripts/site.js defer></script></body></html>
<!doctype html><html lang=en-gb><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><title>Upgrading to .NET 8: Part 6 - The Stable Release | The blog of a software developer and tester.</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="author" content="Martin Costello"><meta name=copyright content="&copy; Martin Costello 2014-2025"><meta name=description content="Highlights from upgrading to the stable release of .NET 8"><meta name=language content="en"><meta name=theme-color content="#ffffff"><meta name=keywords content="dotnet,preview,upgrade"><meta name=robots content="INDEX"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="article:author" content="10100867762061905"><meta property="article:published_time" content="2023-11-20T00:00:00Z"><meta property="article:modified_time" content="2023-11-20T00:00:00Z"><meta property="article:tag" content="dotnet,preview,upgrade"><meta property="fb:profile_id" content="10100867762061905"><meta name=application-name content="Martin Costello's Blog"><meta name=msapplication-config content="browserconfig.xml"><meta name=msapplication-navbutton-color content="#0095DA"><meta name=msapplication-starturl content="/"><meta property="og:description" content="Highlights from upgrading to the stable release of .NET 8"><meta property="og:image" content="https://cdn.martincostello.com/blog_dotnet-bot.png"><meta property="og:locale" content="en_GB"><meta property="og:site_name" content="Martin Costello's Blog"><meta property="og:title" content="Upgrading to .NET 8: Part 6 - The Stable Release"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-11-20T00:00:00Z"><meta property="og:url" content="https://blog.martincostello.com/upgrading-to-.net-8-part-6-the-stable-release/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@martin_costello"><meta name=twitter:description content="Highlights from upgrading to the stable release of .NET 8"><meta name=twitter:domain content="blog.martincostello.com"><meta name=twitter:image content="https://cdn.martincostello.com/blog_dotnet-bot.png"><meta name=twitter:image:alt content="Martin Costello"><meta name=twitter:site content="@martin_costello"><meta name=twitter:title content="Upgrading to .NET 8: Part 6 - The Stable Release"><meta name=twitter:url content="https://blog.martincostello.com/upgrading-to-.net-8-part-6-the-stable-release/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Martin Costello"><meta name=google-site-verification content="ji6SNsPQEbNQmF252sQgQFswh-b6cDnNOa3AHvgo4J0"><meta name=msvalidate.01 content="D6C2E7551C902F1A396D8564C6452930"><link rel=canonical href=https://blog.martincostello.com/upgrading-to-.net-8-part-6-the-stable-release/><link rel=manifest href=/manifest.webmanifest><link href=https://cdn.martincostello.com/favicon.ico rel="shortcut icon" type=image/x-icon><link href=/sitemap.xml rel=sitemap type=application/xml><link href=/feed.xml rel=alternate type=application/rss+xml title=Atom></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container><a href=/ class=navbar-brand><span class="fa-solid fa-laptop-code" aria-hidden=true></span>
blog.martincostello.com
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#site-navbar aria-controls=site-navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=site-navbar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/archive/ title="View the post archive">Archive
<span class="fa-solid fa-box-archive" aria-hidden=true></span></a></li></ul><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-me/ title="About Martin">About Me
<span class="fa-solid fa-circle-info" aria-hidden=true></span></a></li></ul></div></div></nav><main class="container body-content"><div class="p-4 mb-3 bg-light rounded-3"><div class="container-fluid py-3"><h1 class=display-5>Upgrading to .NET 8: Part 6 - The Stable Release</h1><p class="col-md-8 fs-4 lead">Highlights from upgrading to the stable release of .NET 8</p></div></div><p><div class="row d-none d-md-block"><div class=col-6>20 November 2023 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a> |
<a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></div></div><div class="row d-md-none"><div class=col-12>20 November 2023 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a></div><div class=col-12><a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></p></div></div></p><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Upgrading+to+.NET+8%3A+Part+6+-+The+Stable+Release+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fupgrading-to-.net-8-part-6-the-stable-release%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><p>Last week at <a href=https://www.dotnetconf.net/ title=".NET Conf 2023">.NET Conf 2023</a>, the stable release of .NET 8 was released as the latest <a href=https://dotnet.microsoft.com/platform/support/policy/dotnet-core title=".NET and .NET Core Support Policy">Long Term Support</a> (LTS) release of the .NET platform.</p><p>With the release of .NET 8.0.0 and the end of the preview releases, my past week can be summed up by the following image:</p><img class="img-fluid mx-auto d-block" src=https://cdn.martincostello.com/blog_upgrade-all-the-things.jpg alt="The All the Things meme, with the text: Upgrade All The Things To .NET 8" title="The All the Things meme, with the text: Upgrade All The Things To .NET 8"><p>READMORE</p><h2 id=upgrading-all-the-things>Upgrading All The Things</h2><p>You may think that&rsquo;s an exaggeration, but it&rsquo;s not far from the truth. üòÖ</p><p>Over the past 7 days I (or <a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-2-automation-is-our-friend title="Automation is our Friend">my automation</a>) have upgraded the default branch of over 60 GitHub repositories to use the stable release .NET 8, from either .NET 6/7 or .NET 8 Release Candidate 2.</p><p>Highlights of the upgrade have included:</p><ul><li>Updating all the apps I run in Azure App Service and AWS Lambda to run on .NET 8, such as my Alexa Skill <a href=https://www.amazon.co.uk/dp/B01NB0T86R title="London Travel Alexa Skill on amazon.co.uk">London Travel</a>.</li><li><a href=https://github.com/App-vNext/Polly/releases/tag/8.2.0 title="Polly 8.2.0">Polly v8.2.0</a>, which adds support for <code>net8.0</code> as well as use of the new <a href=https://learn.microsoft.com/dotnet/api/system.timeprovider title="The System.TimeProvider Class"><code>TimeProvider</code></a> API.</li><li>Releases of the aspnet-contrib <a href=https://github.com/aspnet-contrib/AspNet.Security.OAuth.Providers/releases/tag/8.0.0 title="AspNet.Security.OAuth.Providers 8.0.0">OAuth</a> and <a href=https://github.com/aspnet-contrib/AspNet.Security.OpenId.Providers/releases/tag/8.0.0 title="AspNet.Security.OpenId.Providers 8.0.0">OpenID</a> packages for ASP.NET Core 8.</li></ul><h2 id=an-almost-pain-free-upgrade>An (Almost) Pain Free Upgrade</h2><p>Through testing with the preview releases over this release cycle, the upgrade to the stable release was pretty much a non-event, everything Just Worked‚Ñ¢Ô∏è.</p><p>There was only one thing which caught me out, and that was that the <code>Microsoft.Extensions.Http.Telemetry</code> NuGet package was renamed between RC2 and the stable release to <a href=https://www.nuget.org/packages/Microsoft.Extensions.Http.Diagnostics><code>Microsoft.Extensions.Http.Diagnostics</code></a>. This was temporarily confusing as the <a href=https://devblogs.microsoft.com/dotnet/announcing-dotnet-8/ title="Announcing .NET 8">annoucement blog post</a> included the old name, but the 8.0.0 NuGet package was not available. I <a href=https://github.com/dotnet/extensions/issues/4723 title="Missing stable package for Microsoft.Extensions.Http.Telemetry">queried this with the team</a> and they confirmed the name change the next day.</p><p>Within 24 hours of the release, I&rsquo;d updated all of the applications and libraries I&rsquo;m responsible for maintaining to either target .NET 8, or build with the .NET 8 SDK. üöÄ</p><p>There was however a <em>tangential</em> issue I stumbled into while working through all the updates for both my open source repositories and projects I help maintain internally at work.</p><h2 id=amazon-linux-2023>Amazon Linux 2023</h2><p>On the 9th of November, AWS <a href=https://aws.amazon.com/about-aws/whats-new/2023/11/aws-lambda-amazon-linux-2023/ title="AWS Lambda adds support for Amazon Linux 2023">announced support for Amazon Linux 2023</a> as a custom runtime for AWS Lambda. I&rsquo;ve been waiting for this to be released for a while as it has been in preview for quite some time, and I&rsquo;ve been using the Amazon Linux 2 custom runtime since it was released. Amazon Linux 2023 also looks like it&rsquo;ll be the basis for any forthcoming AWS Lambda managed runtime support for .NET 8 (soon I hope ü§û) - it&rsquo;s already used as the basis for the new <a href=https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html>Node.js 20.x and Java 21 managed runtimes</a>.</p><p>I was just leaving for a short break in Norway when the release was announced, so I didn&rsquo;t see the annoucement until I next sat in front of a computer again on the 14th of November. As I was already (or about to) update a bunch of applications for .NET 8 later in the day, I figured I&rsquo;d get ahead of the curve and update the AWS Lambda functions I maintain to use the new runtime in advance of those changes.</p><p>Things were all pretty painless as with the subsequent .NET 8 updates&mldr;or so I thought.</p><p>A few days later I noticed that some non-critical automation we use internally to deploy GitHub releases had stopped auto-approving releases deemed as &ldquo;safe&rdquo; for automated deployment. I dug into the error logs for the application in Kibana and found the following warning logged:</p><p><code>The value Europe/London could not be parsed as a TimeZoneInfo value.</code></p><p>A little refactoring later and adjusting the logging lead to the following exception that was being swallowed on the assumption it would only fail for mis-configured time zone IDs:</p><pre class="highlight plaintext"><code>System.TimeZoneNotFoundException: The time zone ID 'Europe/London' was not found on the local computer.
 ---> System.IO.DirectoryNotFoundException: Could not find a part of the path '/usr/share/zoneinfo/Europe/London'.
   at Interop.ThrowExceptionForIoErrno(ErrorInfo errorInfo, String path, Boolean isDirError)
   at Microsoft.Win32.SafeHandles.SafeFileHandle.Open(String path, OpenFlags flags, Int32 mode, Boolean failForSymlink, Boolean& wasSymlink, Func`4 createOpenException)
   at Microsoft.Win32.SafeHandles.SafeFileHandle.Open(String fullPath, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize, UnixFileMode openPermissions, Int64& fileLength, UnixFileMode& filePermissions, Boolean failForSymlink, Boolean& wasSymlink, Func`4 createOpenException)
   at System.IO.Strategies.OSFileStreamStrategy..ctor(String path, FileMode mode, FileAccess access, FileShare share, FileOptions options, Int64 preallocationSize, Nullable`1 unixCreateMode)
   at System.TimeZoneInfo.ReadAllBytesFromSeekableNonZeroSizeFile(String path, Int32 maxFileSize)
   at System.TimeZoneInfo.TryGetTimeZoneFromLocalMachineCore(String id, TimeZoneInfo& value, Exception& e)</code>
</pre><p>The failures were coming from the calls to <a href=https://learn.microsoft.com/dotnet/api/system.timezoneinfo.findsystemtimezonebyid title="TimeZoneInfo.FindSystemTimeZoneById(String) Method"><code>TimeZoneInfo.FindSystemTimeZoneById(string)</code></a> used to convert UTC <code>DateTimeOffset</code> values to their local time zone equivalents. The failure was causing release window definitions used by the automation to be failed to be parsed, so the code was failing safe and not auto-approving the deployments as it didn&rsquo;t know whether it was a safe time of day to do so.</p><p>A little more probing around on the Amazon Linux 2023 instead lead me to the conclusion that the <a href=https://www.iana.org/time-zones title="IANA Time Zone Database"><code>tzdb</code></a> package isn&rsquo;t installed on Amazon Linux 2023. That&rsquo;s an unfortunate change compared to Amazon Linux 2, where it is installed by default. I couldn&rsquo;t find any documentation for Amazon Linux 2023 either way on whether it should or shouldn&rsquo;t have been installed, so I <a href=https://github.com/aws/aws-lambda-dotnet/issues/1620 title="Install tzdb on provided.al2023 runtime so that TimeZoneInfo.FindSystemTimeZoneById() works">raised an issue with the AWS .NET team</a>.</p><p>It turns out that this is a known issue the AWS Lambda team are aware of, but there&rsquo;s currently no guidance on what to do instead or whether the distribution will be changed to include the tzdb package by default.</p><p>I can see the rationale for removing it to make the distribution smaller, but time zone handling is quite a common requirement for applications, so it&rsquo;s a shame it&rsquo;s not included by default as it breaks the ability to use the out-of-the-box .NET APIs for time zone handling (especially with the new <a href=https://learn.microsoft.com/dotnet/api/system.timeprovider title="The System.TimeProvider Class"><code>TimeProvider</code></a> API).</p><p>In the meantime, I&rsquo;ve worked around the issue by (re)adding a dependency on the <a href=https://github.com/nodatime/nodatime title="NodaTime repository on GitHub.com">NodaTime</a> NuGet package to handle time zone conversions.</p><p>NodaTime contains an embedded version of the tzdb database, which can be easily used to convert between time zones. I would prefer to not use NodaTime to keep the deployed application size down and not have an extra NuGet dependency to keep up to date, but it&rsquo;s a small change to make.</p><p>The code changes required for this scenario are pretty simple, as the following example shows.</p><p>Before the code was essentially this:</p><pre class="highlight plaintext"><code>var timeZoneId = "Europe/London";
var utcNow = TimeProvider.System.GetUtcNow();
var timeZone = TimeZoneInfo.FindSystemTimeZoneById(timeZoneId);
var localNow = TimeZoneInfo.ConvertTimeFromUtc(utcNow, timeZone);</code>
</pre><p>Using NodaTime, the code becomes:</p><pre class="highlight plaintext"><code>var timeZoneId = "Europe/London";
var utcNow = TimeProvider.System.GetUtcNow();
var timeZone = DateTimeZoneProviders.Tzdb[timeZoneId];
var localNow = Instant.FromDateTimeUtc(utcNow).InZone(timeZone).ToDateTimeUnspecified();</code>
</pre><p>I hope that the AWS teams will be able to add tzdb to Amazon Linux 2023 so I can remove NodaTime again, but if it&rsquo;s not added to the custom
runtime I certainly hope it&rsquo;s added to any forthcoming managed runtime for .NET 8. Otherwise, I can see a lot of developers needing to update
existing code to change how they deal with time zones when running in AWS Lambda compared to using the .NET 6 managed runtime for what should
otherwise be a relatively straightforward upgrade.</p><h2 id=summary>Summary</h2><p>That&rsquo;s a wrap for .NET 8 for 2023 - now it becomes <em>&ldquo;just the current version&rdquo;</em> for background patching and security updates.</p><p>As well as replacing both .NET 6 and 7 as the latest and greatest release with its status of LTS, .NET 8 brought us tonnes of improvements;</p><ul><li>Improved performance;</li><li>C# 12;</li><li>Expanded native AoT support;</li><li><a href=https://learn.microsoft.com/dotnet/aspire/get-started/aspire-overview title=".NET Aspire overview">.NET Aspire</a>;</li><li>and much more!</li></ul><p>We truly are spoiled by the .NET team as they continue to invest and iterate on making it a highly competitive and productive development platform.</p><p>See you in 2024 for the .NET 9 upgrade! üòé</p><h2 id=upgrading-to-net-8-series-links>Upgrading to .NET 8 Series Links</h2><p>You can find links to the other posts in this series below.</p><ul><li><a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-1-why-upgrade title="Why Upgrade?">Part 1 - Why Upgrade?</a></li><li><a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-2-automation-is-our-friend title="Automation is our Friend">Part 2 - Automation is our Friend</a></li><li><a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-3-previews-1-to-5 title="Previews 1-5">Part 3 - Previews 1-5</a></li><li><a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-4-preview-6 title="Preview 6">Part 4 - Preview 6</a></li><li><a href=https://blog.martincostello.com/upgrading-to-dotnet-8-part-5-preview-7-and-rc-1-2 title="Preview 7 and Release Candidates 1 and 2">Part 5 - Preview 7 and Release Candidates 1 and 2</a></li><li>Part 6 - The Stable Release (this post)</li></ul><hr><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Upgrading+to+.NET+8%3A+Part+6+-+The+Stable+Release+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fupgrading-to-.net-8-part-6-the-stable-release%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><hr><footer><p><div class=row><div class="d-none d-md-block col">&copy; Martin Costello 2014-2025 |
Built from <a href=https://github.com/martincostello/blog/commit/4116b929c2636f9c037d8c2a6c02e0a2140cd9fc rel=noopener title="View commit 4116b929c2636f9c037d8c2a6c02e0a2140cd9fc on GitHub">4116b92</a> on <a href=https://github.com/martincostello/blog/tree/copilot/fix-244 rel=noopener title="View branch copilot/fix-244 on GitHub">copilot/fix-244</a></div><div class=d-md-none><div class=col>&copy; Martin Costello 2014-2025</div></div></div></p></footer></main><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.7/flatly/bootstrap.min.css integrity="sha512-O+EA0Agf5+pB8u7CtnIAYq/BKyFPMT8c0DFjmqLyfIJJ9Fm8GBohV/0H0TFaZ96+jieN8zUVY4IkSBso9z6hpg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=/styles/site.css><script src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js integrity="sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src="https://www.googletagmanager.com/gtag/js?id=G-XJFV74HRL6" async></script><script>window.hugoSiteParams={render_analytics:!0,analytics_id:"G-XJFV74HRL6"}</script><script src=/scripts/site.js defer></script></body></html>
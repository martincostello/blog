<!doctype html><html lang=en-gb><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><title>Ensuring Your ASP.NET Website Is Secure | The blog of a software developer and tester.</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="author" content="Martin Costello"><meta name=copyright content="&copy; Martin Costello 2014-2025"><meta name=description content="How to ensure your ASP.NET Website is secure against common attack vectors, such as CSRF and XSS."><meta name=language content="en"><meta name=theme-color content="#ffffff"><meta name=keywords content="security"><meta name=robots content="INDEX"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="article:author" content="10100867762061905"><meta property="article:published_time" content="2014-03-04T00:00:00Z"><meta property="article:modified_time" content="2014-03-04T00:00:00Z"><meta property="article:tag" content="security"><meta property="fb:profile_id" content="10100867762061905"><meta name=application-name content="Martin Costello's Blog"><meta name=msapplication-config content="browserconfig.xml"><meta name=msapplication-navbutton-color content="#0095DA"><meta name=msapplication-starturl content="/"><meta property="og:description" content="How to ensure your ASP.NET Website is secure against common attack vectors, such as CSRF and XSS."><meta property="og:image" content="https://cdn.martincostello.com/martin_small-v3.png"><meta property="og:locale" content="en_GB"><meta property="og:site_name" content="Martin Costello's Blog"><meta property="og:title" content="Ensuring Your ASP.NET Website Is Secure"><meta property="og:type" content="article"><meta property="og:updated_time" content="2014-03-04T00:00:00Z"><meta property="og:url" content="https://blog.martincostello.com/ensuring-your-asp.net-website-is-secure/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@martin_costello"><meta name=twitter:description content="How to ensure your ASP.NET Website is secure against common attack vectors, such as CSRF and XSS."><meta name=twitter:domain content="blog.martincostello.com"><meta name=twitter:image content="https://cdn.martincostello.com/martin_small-v3.png"><meta name=twitter:image:alt content="Martin Costello"><meta name=twitter:site content="@martin_costello"><meta name=twitter:title content="Ensuring Your ASP.NET Website Is Secure"><meta name=twitter:url content="https://blog.martincostello.com/ensuring-your-asp.net-website-is-secure/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Martin Costello"><meta name=google-site-verification content="ji6SNsPQEbNQmF252sQgQFswh-b6cDnNOa3AHvgo4J0"><meta name=msvalidate.01 content="D6C2E7551C902F1A396D8564C6452930"><link rel=canonical href=https://blog.martincostello.com/ensuring-your-asp.net-website-is-secure/><link rel=manifest href=/manifest.webmanifest><link href=https://cdn.martincostello.com/favicon.ico rel="shortcut icon" type=image/x-icon><link href=/sitemap.xml rel=sitemap type=application/xml><link href=/feed.xml rel=alternate type=application/rss+xml title=Atom></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container><a href=/ class=navbar-brand><span class="fa-solid fa-laptop-code" aria-hidden=true></span>
blog.martincostello.com
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#site-navbar aria-controls=site-navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=site-navbar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/archive/ title="View the post archive">Archive
<span class="fa-solid fa-box-archive" aria-hidden=true></span></a></li></ul><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-me/ title="About Martin">About Me
<span class="fa-solid fa-circle-info" aria-hidden=true></span></a></li></ul></div></div></nav><main class="container body-content"><div class="p-4 mb-3 bg-light rounded-3"><div class="container-fluid py-3"><h1 class=display-5>Ensuring Your ASP.NET Website Is Secure</h1><p class="col-md-8 fs-4 lead">How to ensure your ASP.NET Website is secure against common attack vectors, such as CSRF and XSS.</p></div></div><p><div class="row d-none d-md-block"><div class=col-6>4 March 2014 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a> |
<a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></div></div><div class="row d-md-none"><div class=col-12>4 March 2014 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a></div><div class=col-12><a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></p></div></div></p><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Ensuring+Your+ASP.NET+Website+Is+Secure+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fensuring-your-asp.net-website-is-secure%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><p>So recently I&rsquo;ve been doing some work ensuring some websites I work on are secure. This has been from a mix of hands-on testing of them myself, dealing with feedback from dedicated security testers testing the applications, and this week attending an &ldquo;ASP.NET Secure Coding&rdquo; training course.</p><p>From my own testing I found the odd thing here and there during development based on what I&rsquo;ve read in the past is best-practice. These were exclusively application/coding changes. Fixing these was a mix of &ldquo;Oh yeah&rdquo; realisations or a quick Google leading to MSDN or Stack Overflow, leading to some simple one-line changes here and there.</p><p>The same was true of the results from the dedicated security testers. This was slightly more work, as they were very good at saying &ldquo;X is an issue&rdquo;, but almost useless at saying how to fix it. They also did some tests which were more of the server and network configuration, which in some cases fell out of my personal work remit. However, a secure app is a secure app, meaning that you just can&rsquo;t ignore it because it&rsquo;s not controllable by the code. This meant yet further reading to find out how to fix the software issues, as well as reading further afield to find out how to fix the server and network configuration issues as well.</p><p>Then there was the security testing course. The title was a bit of a misnomer, as it wasn&rsquo;t so much &ldquo;how to code securely&rdquo; as &ldquo;how to find security problems&rdquo;. It was very useful as it was quite eye-opening to discover what seemingly innocent &ldquo;oh that&rsquo;s not important&rdquo; small niggly things could, in the hands of a skilled &ldquo;hacker&rdquo;, actually lead to your machine being completely owned by an attacker.</p><p>However, after three rounds of realisation, fixing and testing, there was one common theme I found with all of this - there was no central resource detailing how to fix all of the issues that came up. There were a lot of resources where just one problem would be described (and sometimes a fix for it described), but a lot of the time there&rsquo;d be a page about a problem, but you&rsquo;d need to go to a completely different one for the fix. Some required some creative Googling to find, others were right there (if you knew what you were looking for).</p><p>So, Dear Reader, why have I written this? Well, I thought it would be a good idea to collate all the stuff that&rsquo;s best practice into a single blog post, and then include for each one the instructions of how to fix it. Helpful right? Well, at least I hope so.</p><p>READMORE</p><p>I&rsquo;ve arranged them by flaw/requirement, with a quick explanation for each and then the steps to fix. Some fixes are code, some are Web.config settings, and others require digging around in the Registry. After that there&rsquo;s some links to resources you can use to help test your site to check for a number of vulnerabilities you want to be protected against.</p><p>In the spirit of <a href=http://www.hanselman.com/>Scott Hanselman</a> I&rsquo;d just like to point out: <strong>any changes you make are at your own risk</strong>. While these changes worked for me, make sure you test them yourself to ensure they solve the issue for you. Also, these fixes may not solve a particular vulnerability fully. I believe they do, but I don&rsquo;t have the full resources to exhaustively test every single one. Also, some may not be appropriate for your website. If that&rsquo;s true, that&rsquo;s your call - after all, it&rsquo;s your website. Basically <em>caveat emptor</em>.</p><p>With no further ado, the things to make sure you do&mldr;</p><h2 id=require-ssl>Require SSL</h2><p>This is an IIS setting, and it&rsquo;s pretty easy to enable. This ensures your IIS server returns a HTTP <code>301 Moved Permanently</code> or <code>302 Found</code> HTTP code and redirects to the HTTPS version of your site. This is to protect against main-in-the-middle and Strip HTTPS attacks.</p><p>For example if a user browses to <a href=http://martincostello.com/>http://martincostello.com/</a> they will receive an HTTP <code>301 Moved Permanently</code> and be redirected to <a href=https://martincostello.com/>https://martincostello.com/</a> instead.</p><p>Here&rsquo;s the output from a cURL request to my website <code>http://martincostello.com/</code> for example:</p><pre tabindex=0><code>c:\Tools\Curl&gt;curl http://martincostello.com/ -v
* Adding handle: conn: 0x1fe3148
* Adding handle: send: 0
* Adding handle: recv: 0
* Curl_addHandleToPipeline: length: 1
* - Conn 0 (0x1fe3148) send_pipe: 1, recv_pipe: 0
* About to connect() to martincostello.com port 80 (#0)
*   Trying 94.245.106.104...
* Connected to martincostello.com (94.245.106.104) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; User-Agent: curl/7.31.0
&gt; Host: martincostello.com
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 301 Moved Permanently
&lt; Content-Length: 150
&lt; Content-Type: text/html; charset=UTF-8
&lt; Location: https://martincostello.com/
&lt; Arr-Disable-Session-Affinity: True
&lt; X-Frame-Options: DENY
&lt; Date: Wed, 17 Jun 2015 17:56:08 GMT
&lt; &lt;head&gt;&lt;title&gt;Document Moved&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Object Moved&lt;/h1&gt;This document may be found &lt;a HREF=&#34;https://martincostello.com/&#34;&gt;here&lt;/a&gt;&lt;/body&gt;
* Connection #0 to host martincostello.com left intact
</code></pre><p>The parts of interest are the following two parts of the response:</p><pre tabindex=0><code>&lt; HTTP/1.1 301 Moved Permanently
&lt; Location: https://martincostello.com/
</code></pre><p><em>Updated 08/02/2015</em></p><p>If you don&rsquo;t have access to the full IIS configuration (for example you are using Azure Websites), and are using ASP.NET MVC, you can use the <a href="https://msdn.microsoft.com/en-us/library/system.web.mvc.requirehttpsattribute%28v=vs.118%29.aspx">RequireHttpsAttribute</a> attribute in your filters as shown below. This only works for requests processed by the MVC pipeline, so won&rsquo;t work for static content, for example.</p><pre tabindex=0><code>using System.Web.Mvc;

namespace MyWebsite
{
    internal static class FilterConfig
    {
        internal static void RegisterGlobalFilters(GlobalFilterCollection filters)
        {
            filters.Add(new RequireHttpsAttribute());
        }
    }
}
</code></pre><p>If you can&rsquo;t easily run any custom code like the MVC example above, you can use an IIS URL Rewrite rule in Web.config to do this instead, as shown below:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;rewrite&gt;
      &lt;rules&gt;
        &lt;rule name=&#34;Redirect to HTTPS&#34; stopProcessing=&#34;true&#34;&gt;
          &lt;match url=&#34;(.*)&#34; /&gt;
          &lt;conditions&gt;
            &lt;add input=&#34;{HTTPS}&#34; pattern=&#34;off&#34; ignoreCase=&#34;true&#34; /&gt;
            &lt;add input=&#34;{HTTP_HOST}&#34; negate=&#34;true&#34; pattern=&#34;localhost&#34; /&gt;
          &lt;/conditions&gt;
          &lt;action type=&#34;Redirect&#34; url=&#34;https://{HTTP_HOST}/{R:1}&#34; redirectType=&#34;Permanent&#34; /&gt;
        &lt;/rule&gt;
      &lt;/rules&gt;
    &lt;/rewrite&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p><em>Updated 17/06/2015</em></p><p>If you are using MVC, as of <a href=http://aspnetwebstack.codeplex.com/SourceControl/changeset/9efcaf3315962488823acead507db18bf5c3e29d>ASP.NET 5.2.4</a> you can issue an HTTP <code>301</code> instead of a HTTP <code>302</code> in the following way:</p><pre tabindex=0><code>using System.Web.Mvc;

namespace MyWebsite
{
    internal static class FilterConfig
    {
        internal static void RegisterGlobalFilters(GlobalFilterCollection filters)
        {
            filters.Add(new RequireHttpsAttribute(permanent: true));
        }
    }
}
</code></pre><p>As of ASP.NET MVC 6 only permanent redirects are supported.</p><p>To force MVC to require HTTPS for anti-forgery tokens, you can set this line of code:</p><pre tabindex=0><code>AntiForgeryConfig.RequireSsl = true;
</code></pre><p><em>Updated 30/11/2015</em></p><p>I&rsquo;ve noticed that the redirect can be cached in some browsers (e.g. Chrome) and can prevent you from serving any content over HTTP on <code>localhost</code>. You can prevent this by checking whether the request is for <code>localhost</code> (which the <code>Web.config</code> sample above has been adjusted to show).</p><h2 id=use-anti-forgery-tokens>Use Anti-Forgery Tokens</h2><p>If using MVC you should use anti-forgery tokens when submitting your forms via HTTP POST. This protects against Cross-Site Request Forgery (CSRF) <a href=https://en.wikipedia.org/wiki/Cross-site_request_forgery title="Read about CSRF on Wikipedia">attacks</a>. This is a two-step process.</p><p>First, generate an anti-forgery token in your forms in your views:</p><pre tabindex=0><code>@Html.AntiForgeryToken()
</code></pre><p>Second, apply the attribute to your controller action methods that are posts:</p><pre tabindex=0><code>[HttpPost]
[ValidateAntiForgeryToken]
public ActionResult LogOff()
{
    WebSecurity.Logout();
    return RedirectToAction(&#34;Index&#34;, &#34;Home&#34;);
}
</code></pre><p>Something to watch out for here is if you do AJAX POST requests from your views. These also need to be CSRF safe, but can&rsquo;t use the same mechanism as for your action links, forms etc. A good description of how to fix this can be found on the <a href=http://www.asp.net/web-api/overview/security/preventing-cross-site-request-forgery-%28csrf%29-attacks>ASP.NET website</a>.</p><h2 id=enable-iis-custom-errors>Enable IIS Custom Errors</h2><p>This is a pretty simple one. As well as improving the user-experience, it makes sure you don&rsquo;t accidentally leak error details (e.g. stack traces) to clients in the event of an exception occurring. There&rsquo;s two settings for this, one for IIS 6 and one for IIS 7. It&rsquo;s best to set both of these, so the below should be present as a bare minimum. Obviously, you can customise these further - see MSDN for details.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode=&#34;On&#34; defaultRedirect=&#34;~/Error&#34; /&gt;
  &lt;/system.web&gt;
  &lt;system.webServer&gt;
    &lt;httpErrors errorMode=&#34;Custom&#34; /&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><h2 id=disable-debug-compilation>Disable Debug Compilation</h2><p>This isn&rsquo;t really a security setting, more of a performance one, but it can cause a number of features to be automatically disabled, so you shouldn&rsquo;t be running it in Debug in production. Simple to turn off:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;compilation debug=&#34;false&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=disable-ssl-2>Disable SSL 2</h2><p>SSL V2 is considered to be <a href=https://en.wikipedia.org/wiki/Transport_Layer_Security#SSL_2.0>cryptographically broken</a>, however it&rsquo;s enabled by default on many Windows servers. To disable it, add/edit the Registry key detailed in this Microsoft <a href=https://support.microsoft.com/en-us/kb/187498>KB article</a>.</p><h2 id=disable-rc4-ciphers>Disable RC4 Ciphers</h2><p>RC4 ciphers are also considered to be <a href=https://en.wikipedia.org/wiki/RC4>cryptographically broken</a>, and again are enabled by default on many Windows servers. To disable it, add/edit the Registry key detailed in this Microsoft <a href=https://support.microsoft.com/en-us/kb/245030>KB article</a>.</p><h2 id=html-encode-user-supplied-input>HTML Encode User-Supplied Input</h2><p>You should never trust user input, <strong>ever</strong>, and never &ldquo;mirror&rdquo; it back to the user without HTML encoding it first. If MVC using the Razor view engine, this is handled for you automatically - you have to opt-in to shooting yourself in the foot.</p><p>For the non-Razor MVC view engine and for ASP.NET Web Forms, you need to ensure your HTML escape it yourself using one of the two syntaxes:</p><ol><li>ASP.NET Web Forms: <code>HttpUtility.HtmlEncode(Model.Value)</code></li><li>ASP.NET MVC: <code>HtmlHelper.Encode(Model.Value)</code></li></ol><h2 id=dont-expose-the-iis-version>Don&rsquo;t Expose the IIS Version</h2><p>The IIS version is exposed via the <code>Server</code> HTTP response header. It&rsquo;s best to disable this as it helps hide the version of server software you&rsquo;re using to make it just a bit harder for an attacker to find known vulnerabilities to use against you. If you&rsquo;re using IIS 7 and Integrated Pipeline mode, you can disable it this way:</p><pre tabindex=0><code>protected void Application_PreSendRequestHeaders()
{
    this.Response.Headers.Remove(&#34;Server&#34;);
}
</code></pre><p>To make sure this is suppressed for all requests (e.g. for static content such as JavaScript), you should also add the following setting if you&rsquo;re using IIS 7:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;modules runAllManagedModulesForAllRequests=&#34;true&#34; /&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p><em>Updated 08/02/2015</em></p><p>If you&rsquo;re using Azure Websites, you can also use the following setting in Web.config as documented here to remove the <code>Server</code> HTTP response header:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;security&gt;
      &lt;requestFiltering removeServerHeader=&#34;true&#34; /&gt;
    &lt;/security&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><h2 id=dont-expose-the-aspnet-version>Don&rsquo;t Expose the ASP.NET Version</h2><p>As with the IIS version, for the same reasons it&rsquo;s also best to hide the ASP.NET version you&rsquo;re using to clients as well. You can accomplish this with the following Web.config setting in IIS 7.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;httpProtocol&gt;
      &lt;customHeaders&gt;
        &lt;remove name=&#34;X-Powered-By&#34; /&gt;
      &lt;/customHeaders&gt;
    &lt;/httpProtocol&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p><em>Updated 08/02/2015</em></p><p>If you don&rsquo;t have access to the full IIS configuration (for example you are using Azure Websites) and can&rsquo;t run any custom code to remove the <code>X-Powered-By</code> header, than you can use an IIS URL Rewrite rule to blank the value instead.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;rewrite&gt;
      &lt;outboundRules rewriteBeforeCache=&#34;true&#34;&gt;
        &lt;rule name=&#34;Remove X-Powered-By HTTP response header&#34;&gt;
          &lt;match serverVariable=&#34;RESPONSE_X-Powered-By&#34; pattern=&#34;.+&#34; /&gt;
          &lt;action type=&#34;Rewrite&#34; value=&#34;&#34; /&gt;
        &lt;/rule&gt;
      &lt;/outboundRules&gt;
    &lt;/rewrite&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p><em>Updated 17/06/2015</em></p><p>You can also remove this using the following setting:</p><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;httpRuntime enableVersionHeader=&#34;false&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=dont-expose-the-aspnet-mvc-version>Don&rsquo;t Expose the ASP.NET MVC Version</h2><p>As above (again), you should also hide the MVC version you&rsquo;re using. This is a simple one-line code change:</p><pre tabindex=0><code>MvcHandler.DisableMvcResponseHeader = true;
</code></pre><h2 id=secure-the-root-of-your-site>Secure The Root Of Your Site</h2><p>If you use a virtual directory for your site, you might have the root of the website just pointing to <code>C:\Inetpub\wwwroot</code> and its default settings. This will undo all of the changes you make in your sub-directory for security if someone just navigates to the root.</p><p>The best way to deal with this is to manually configure the root site to:</p><ol><li>Require HTTPS;</li><li>Redirect all requests to the root to your virtual directory.</li></ol><p>If you do this, two things to consider:</p><ol><li>Ensure that any IIS 7 custom error pages include the full path to your site in the virtual directory.</li><li>You disable HTTP redirects on the site in your virtual directory. In IIS 7, you do this with the following Web.config setting.</li></ol><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;httpRedirect enabled=&#34;false&#34; /&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><h2 id=use-strict-transport-security>Use Strict Transport Security</h2><p>This is again designed to help prevent man-in-the-middle and HTTPS Strip attacks. More information can be found <a href=https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security title="Read about HSTS on Wikipedia">here on Wikipedia</a>.</p><p>To enable this, add the following to your <code>Global.asax.cs</code> file:</p><pre tabindex=0><code>protected void Application_PreSendRequestHeaders()
{
    if (!this.Request.IsLocal &amp;&amp; this.Request.IsSecureConnection)
    {
        this.Response.AppendHeader(&#34;Strict-Transport-Security&#34;, &#34;max-age=31536000&#34;);
    }
}
</code></pre><p>In the above example, this instructs the browser to use strict transport security for a year, though this is specified for each request so essentially regenerates itself.</p><p><em>Updated 17/06/2015</em></p><p>If you can&rsquo;t run custom .NET code (e.g. a static site or a PHP site), you can use a URL Rewrite rule as <a href=http://www.hanselman.com/blog/HowToEnableHTTPStrictTransportSecurityHSTSInIIS7.aspx title="Enabling HSTS in II7">suggested here by Scott Hanselman</a>.</p><p><em>Updated 30/11/2015</em></p><p>I&rsquo;ve noticed that this header can be cached in some browsers (e.g. Chrome) and can prevent you from serving any content over HTTP on <code>localhost</code>. You can prevent this by bypassing the addition of the header of <code>HttpRequest.IsLocal</code> is <code>true</code> (which the code sample above has been adjusted to show).</p><h2 id=use-http-only-and-ssl-only-cookies>Use HTTP-Only and SSL-Only Cookies</h2><p>To protect your sites users&rsquo; cookies from being accessed by scripts in other domains and protect against them being read from min-in-the-middle attackers, ensure the following settings is enabled in Web.config:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;httpCookies httpOnlyCookies=&#34;true&#34; requireSSL=&#34;true&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=require-ssl-for-forms-authentication>Require SSL For Forms Authentication</h2><p>Similar to the above, ensure that you use SSL for the cookies used for Forms authentication, assuming you&rsquo;re using the (more secure) cookie-based version, rather than the query string version to store the forms authentication cookie.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;authentication mode=&#34;Forms&#34;&gt;
      &lt;forms requireSSL=&#34;true&#34; /&gt;
    &lt;/authentication&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=prevent-click-jacking-and-framing>Prevent Click-Jacking and Framing</h2><p><a href=https://en.wikipedia.org/wiki/Clickjacking>Click-Jacking</a> and framing is where an attacker uses an IFrame to either host their own scripts around the site you want to visit so they can inspect what you&rsquo;re doing, and/or force/persuade you to click a link to execute an action they want you to perform because they can&rsquo;t do it automatically because of browser security features.
You can prevent framing in IIS 7 Integrated Pipeline mode with this code snippet:</p><pre tabindex=0><code>protected void Application_PreSendRequestHeaders()
{
    this.Response.AppendHeader(&#34;X-Frame-Options&#34;, &#34;DENY&#34;);
}
</code></pre><p>If other sites you manage in the same domain need to frame your site for some reason, then you can use this instead:</p><pre tabindex=0><code>protected void Application_PreSendRequestHeaders()
{
    this.Response.AppendHeader(&#34;X-Frame-Options&#34;, &#34;SAMEORIGIN&#34;);
}
</code></pre><p><strong>N.B.</strong> Preventing framing will prevent you from using tools such as mobile browser emulators. If you need to use such tools, consider making the value configurable. If you choose to do this make sure that the default value is <strong>DENY</strong> and that you don&rsquo;t have it enabled on your production site, only use your configurable &ldquo;off&rdquo; switch on environments such as dev/QA/staging/UAT.</p><p><em>Updated 08/02/2015</em></p><p>If you don&rsquo;t need any runtime configurability and are using at least IIS 7.0, you could also achieve this via Web.config settings are shown below.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;httpProtocol&gt;
      &lt;customHeaders&gt;
        &lt;add name=&#34;X-Frame-Options&#34; value=&#34;DENY&#34; /&gt;
      &lt;/customHeaders&gt;
    &lt;/httpProtocol&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><p>To help further framing, you can use the following Javascript in your page layouts to force your site to &ldquo;burst&rdquo; to the top of the frames in the browser it&rsquo;s being rendered in. This helps eliminate the site from being contained in iframes:</p><pre tabindex=0><code>&lt;script type=&#34;text/javascript&#34;&gt;
    if (self == top) {
        document.documentElement.className = document.documentElement.className.replace(/\bjs-flash\b/, &#39;&#39;);
    }
    else {
        top.location = self.location;
    }
&lt;/script&gt;
</code></pre><h2 id=dont-cache-secure-content>Don&rsquo;t Cache Secure Content</h2><p>If you have secure content on your site (i.e. content you need to be logged in to see), then you should not cache this content. It provides a way for an attacker to potentially access this content via the browser cache, even if the user is not logged in in the current session. The easiest way to do this is to update your Master page or <code>_Layout.cshtml</code> file to add the following HTTP meta tags:</p><pre tabindex=0><code>&lt;meta http-equiv=&#34;Cache-Control&#34; content=&#34;no-cache, no-store&#34; /&gt;
&lt;meta http-equiv=&#34;Pragma&#34; content=&#34;no-cache&#34; /&gt;
</code></pre><h2 id=set-your-machine-encryption-and-decryption-keys>Set Your Machine Encryption and Decryption Keys</h2><p>Everyone likes to be successful, and if your site is you might need to scale out and add new machines to your server farm to handle the load. Even if you don&rsquo;t think you&rsquo;ll get that far, it&rsquo;s a good idea to set the machine keys used to secure things like for forms authentication ticket in your Web.config file explicitly up-front so that you&rsquo;re ready to handle scale out. You can use <a href=https://www.martincostello.com/tools/#GenerateMachineKey>this tool on my website</a> to generate your keys, then you just need to add them to this setting:</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;machineKey decryption=&#34;AES&#34; decryptionKey=&#34;{Your Decryption Key}&#34; validation=&#34;SHA1&#34; validationKey=&#34;{Your Validation Key}&#34;/&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=disable-traceaxd>Disable Trace.axd</h2><p>The Trace.axd HTTP handler is great for debugging, but can leak lots of nasty details to browsers to it if you leave it enabled on your production servers. For example, you could leak users&rsquo; user names and passwords from your log on page. Eeek! This is a doddle to turn off, and is off by default anyway. But it&rsquo;s always good to be explicit and put it in your file and get any installers and/or deployment scripts explicitly turn it off when you deploy to your production servers.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;trace enabled=&#34;false&#34; localOnly=&#34;true&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=testing-resources>Testing Resources</h2><p>I recommend the following resources to help test your sites security after you apply the necessary changes:</p><h3 id=asafawebcom>asafaweb.com</h3><p><a href=https://asafaweb.com/>This site</a> tests your ASP.NET site, and looks for a number of things I&rsquo;ve mentioned above, as well as some other stuff I haven&rsquo;t. It found a few things I hadn&rsquo;t considered on my sites, and helped improve the overall quality.</p><h3 id=qualys-ssl-labs-server-tester>Qualys SSL Labs Server Tester</h3><p><a href=https://www.ssllabs.com/ssltest/index.html>This site</a> tests the server configuration to test for use of things like SSL 2, RC4 ciphers and invalid SSL certificates. It&rsquo;s well worth using - I used it to validate that the changes for SSL v2 and RC4 being disabled as I described above had been accomplished correctly on our servers.</p><p>[This post is a re-post of the article that was <a href=http://martincostello.blogspot.co.uk/2013/09/ensuring-your-aspnet-website-is-secure.html>originally published here</a> &ldquo;Original location of this blog post&rdquo;].</p><h2 id=updated-08022015>Updated 08/02/2015</h2><p>Over the last year or so, there&rsquo;s a number of other settings I&rsquo;ve come across in .NET and in IIS that add to the list of things to check in your website. In fact, there&rsquo;s a few I found today when doing some maintenance on this blog today and hardening the configuration of this site while I was renewing my SSL certificates. Some are new things, and some are additional ways of doing things already listed. For the things already listed, I&rsquo;ve added the new information to the entries above.</p><h2 id=fixing-insecure-cookies-in-azure-websites>Fixing &ldquo;Insecure&rdquo; Cookies In Azure Websites</h2><p>If you&rsquo;re using Azure Websites, you&rsquo;ll find that HTTP requests to your website include a cookie that isn&rsquo;t HTTP-Only and isn&rsquo;t secure called <a href=http://azure.microsoft.com/blog/2013/11/18/disabling-arrs-instance-affinity-in-windows-azure-web-sites/>ARRAffinity</a>. If you don&rsquo;t need Sticky Sessions and you need to remove this cookie, you can apply the following Web.config change to remove it.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.webServer&gt;
    &lt;httpProtocol&gt;
      &lt;customHeaders&gt;
        &lt;add name=&#34;Arr-Disable-Session-Affinity&#34; value=&#34;True&#34; /&gt;
      &lt;/customHeaders&gt;
    &lt;/httpProtocol&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre><h2 id=requiring-secure-cookies-for-role-manager>Requiring Secure Cookies For Role Manager</h2><p>If you&rsquo;re using the ASP.NET Role Manager and are caching the user&rsquo;s role in a cookie, ensure that the cookie is set to require SSL in Web.config, as shown below.</p><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;roleManager cookieRequireSSL=&#34;true&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h2 id=use-secure-cookies-for-owin-cookie-authentication>Use Secure Cookies For OWIN Cookie Authentication</h2><p>If using OWIN Middleware for authentication (e.g. for Microsoft Accounts, Google Accounts, WS-Federation etc.), then sure you set the appropriate options when configuring cookie-based authentiation, as shown below.</p><pre tabindex=0><code>var options = new CookieAuthenticationOptions()
{
    CookieHttpOnly = true,
    CookieSecure = CookieSecureOption.Always,
    ExpireTimeSpan = TimeSpan.FromMinutes(10),  // Set whatever appropriate lifetime your site requires for your security needs
};
</code></pre><h2 id=updated-17062015>Updated 17/06/2015</h2><p>Over the last few months I&rsquo;ve found <em>even more</em> things that are a good idea to do (security is a face-paced world huh?). Here&rsquo;s some more bits and pieces you should consider.</p><h2 id=rename-your-cookies>Rename Your Cookies</h2><p>In the same way that hiding the <code>Server</code> HTTP response header disguises the fact that you are using ASP.NET, cookies served by your site can give the game away due to the default naming schemes used for the default cookies for things like Forms Authentication, Role Manager, ASP.NET Identity etc. Below are some example code snippets and configuration settings you can use to rename your cookies to disguise your technology stack further.</p><h3 id=rename-the-forms-authentication-cookie>Rename the Forms Authentication Cookie</h3><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;authentication&gt;
      &lt;forms name=&#34;myformscookie&#34; /&gt;
    &lt;/authentication&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h3 id=rename-the-role-manager-cookie>Rename the Role Manager Cookie</h3><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;roleManager cookieName=&#34;myrolescookie&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h3 id=rename-the-session-state-cookie>Rename the Session State Cookie</h3><pre tabindex=0><code>&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;sessionState cookieName=&#34;mysessioncookie&#34; /&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</code></pre><h3 id=rename-the-mvc-anti-forgery-cookie>Rename the MVC Anti-Forgery Cookie</h3><pre tabindex=0><code>AntiForgeryConfig.CookieName = &#34;myxsrfcookie&#34;;
</code></pre><h3 id=rename-the-aspnet-identity-cookie>Rename the ASP.NET Identity Cookie</h3><pre tabindex=0><code>var options = new CookieAuthenticationOptions()
{
    CookieName = &#34;myauthcookie&#34;,
};
</code></pre><hr><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Ensuring+Your+ASP.NET+Website+Is+Secure+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fensuring-your-asp.net-website-is-secure%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><hr><footer><p><div class=row><div class="d-none d-md-block col">&copy; Martin Costello 2014-2025 |
Built from <a href=https://github.com/martincostello/blog/commit/1e081eee55dfb7b252dce3b0ab73a36513d14253 rel=noopener title="View commit 1e081eee55dfb7b252dce3b0ab73a36513d14253 on GitHub">1e081ee</a> on <a href=https://github.com/martincostello/blog/tree/copilot/fix-244 rel=noopener title="View branch copilot/fix-244 on GitHub">copilot/fix-244</a></div><div class=d-md-none><div class=col>&copy; Martin Costello 2014-2025</div></div></div></p></footer></main><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.7/flatly/bootstrap.min.css integrity="sha512-O+EA0Agf5+pB8u7CtnIAYq/BKyFPMT8c0DFjmqLyfIJJ9Fm8GBohV/0H0TFaZ96+jieN8zUVY4IkSBso9z6hpg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=/styles/site.css><script src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js integrity="sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src="https://www.googletagmanager.com/gtag/js?id=G-XJFV74HRL6" async></script><script>window.hugoSiteParams={render_analytics:!0,analytics_id:"G-XJFV74HRL6"}</script><script src=/scripts/site.js defer></script></body></html>
<!doctype html><html lang=en-gb><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><title>Publishing My First Alexa Skill | The blog of a software developer and tester.</title>
<meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta property="author" content="Martin Costello"><meta name=copyright content="&copy; Martin Costello 2014-2025"><meta name=description content="Publishing my first Alexa skill using node.js, AWS Lambda, Travis CI and the TfL API."><meta name=language content="en"><meta name=theme-color content="#ffffff"><meta name=keywords content="alexa,skill,tfl,travis,lambda,aws"><meta name=robots content="INDEX"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="article:author" content="10100867762061905"><meta property="article:published_time" content="2017-02-20T00:00:00Z"><meta property="article:modified_time" content="2017-02-20T00:00:00Z"><meta property="article:tag" content="alexa,skill,tfl,travis,lambda,aws"><meta property="fb:profile_id" content="10100867762061905"><meta name=application-name content="Martin Costello's Blog"><meta name=msapplication-config content="browserconfig.xml"><meta name=msapplication-navbutton-color content="#0095DA"><meta name=msapplication-starturl content="/"><meta property="og:description" content="Publishing my first Alexa skill using node.js, AWS Lambda, Travis CI and the TfL API."><meta property="og:image" content="https://cdn.martincostello.com/london-travel-108x108.png"><meta property="og:locale" content="en_GB"><meta property="og:site_name" content="Martin Costello's Blog"><meta property="og:title" content="Publishing My First Alexa Skill"><meta property="og:type" content="article"><meta property="og:updated_time" content="2017-02-20T00:00:00Z"><meta property="og:url" content="https://blog.martincostello.com/publishing-my-first-alexa-skill/"><meta name=twitter:card content="summary"><meta name=twitter:creator content="@martin_costello"><meta name=twitter:description content="Publishing my first Alexa skill using node.js, AWS Lambda, Travis CI and the TfL API."><meta name=twitter:domain content="blog.martincostello.com"><meta name=twitter:image content="https://cdn.martincostello.com/london-travel-108x108.png"><meta name=twitter:image:alt content="Martin Costello"><meta name=twitter:site content="@martin_costello"><meta name=twitter:title content="Publishing My First Alexa Skill"><meta name=twitter:url content="https://blog.martincostello.com/publishing-my-first-alexa-skill/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Martin Costello"><meta name=google-site-verification content="ji6SNsPQEbNQmF252sQgQFswh-b6cDnNOa3AHvgo4J0"><meta name=msvalidate.01 content="D6C2E7551C902F1A396D8564C6452930"><link rel=canonical href=https://blog.martincostello.com/publishing-my-first-alexa-skill/><link rel=manifest href=/manifest.webmanifest><link href=https://cdn.martincostello.com/favicon.ico rel="shortcut icon" type=image/x-icon><link href=/sitemap.xml rel=sitemap type=application/xml><link href=/feed.xml rel=alternate type=application/rss+xml title=Atom></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class=container><a href=/ class=navbar-brand><span class="fa-solid fa-laptop-code" aria-hidden=true></span>
blog.martincostello.com
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#site-navbar aria-controls=site-navbar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=site-navbar><ul class="navbar-nav me-auto"><li class=nav-item><a class=nav-link href=/archive/ title="View the post archive">Archive
<span class="fa-solid fa-box-archive" aria-hidden=true></span></a></li></ul><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about-me/ title="About Martin">About Me
<span class="fa-solid fa-circle-info" aria-hidden=true></span></a></li></ul></div></div></nav><main class="container body-content"><div class="p-4 mb-3 bg-light rounded-3"><div class="container-fluid py-3"><h1 class=display-5>Publishing My First Alexa Skill</h1><p class="col-md-8 fs-4 lead">Publishing my first Alexa skill using node.js, AWS Lambda, Travis CI and the TfL API.</p></div></div><p><div class="row d-none d-md-block"><div class=col-6>20 February 2017 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a> |
<a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></div></div><div class="row d-md-none"><div class=col-12>20 February 2017 by <a href=/about-me/ rel=noopener title="About Martin Costello">Martin Costello</a></div><div class=col-12><a href=/feed.xml rel=noopener title="View the RSS syndication feed"><span class="fa-solid fa-rss" aria-hidden=true></span></a></p></div></div></p><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Publishing+My+First+Alexa+Skill+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fpublishing-my-first-alexa-skill%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><p>A few weeks ago at work it was our quarterly Hackathon. After a dearth of ideas I thought of an idea to extend our Alexa app to incorporate something I&rsquo;ve been working on in the office over the last few months. Over the course of a few days a colleague and I tweaked the skill and achieved our aim, which was pretty fun. Did I mention we also won the technical category?</p><p>Off the back of that success I thought I&rsquo;d have a go at writing my own skill, which was <a href=https://www.amazon.co.uk/dp/B01NB0T86R title="London Travel on amazon.co.uk">finally accepted into the Alexa Skill Store</a> on the 14th February after it&rsquo;s third round of certification tests. It&rsquo;s a fairly simple skill with just two &ldquo;intents&rdquo; that allows you to either ask about current disruption on any London tube line, the London Overground or the DLR, or for just a specific line. It&rsquo;s also 100% open-source, <a href=https://github.com/martincostello/alexa-london-travel title="Alexa London Travel on GitHub">hosted on GitHub</a>. The <a href=https://aws.amazon.com/lambda/pricing/#lambda title="AWS Lambda pricing">free AWS Lambda tier</a> also makes it free to run (unless the skill becomes wildly popular&mldr;).</p><p>Now the dust has settled and I&rsquo;ve got some free time, I thought I&rsquo;d do a blog post about how I got started with Alexa and the idea for the skill, how I coded it and set up the Continuous Integration, how I got it through the certification tests and, finally, setting up monitoring for it in production.</p><p>READMORE</p><h2 id=background>Background</h2><p>Back in November I was lucky enough to travel to Las Vegas for AWS re:Invent through work. Part of the &ldquo;swag&rdquo; you got at registration was a free Echo Dot as an incentive to try and get developers to write new skills for the Alexa Skill Store. The idea of the Echo hadn&rsquo;t particularly leapt out at me when I&rsquo;d seen them advertised, so I hadn&rsquo;t considered buying one myself. Now I&rsquo;d acquired an Echo Dot for free I figured I might as well try it out, so I set it up in my living room once I got back. At this point I hadn&rsquo;t considered actually developing any skills for it.</p><p>To be honest I mostly used it to set timers and check the weather - nothing too complicated - but I also used it to ask simple questions; much in the same way I used to occasionally ask Siri things with my iPhone. I don&rsquo;t use Siri much anymore as I&rsquo;ve found it to not be particularly intelligent for anything beyond setting timers and, unlike Alexa, it isn&rsquo;t really extensible to third-party developers.</p><p>Over the last few months I&rsquo;d also been growing more and more frustrated with the Apple Music app on my iPhone. Most of this frustration came from it deciding to randomly delete songs from storage, opting instead to stream them, even though I don&rsquo;t have an Apple Music subscription. I&rsquo;d only eventually realised this once my commute to work began involving the tube after moving flats. The worst incidence of this was on a four hour flight back from Greece last summer where it decided to delete all the songs from the phone <strong>while I was listening to it</strong> 30 minutes into the flight. That was a fun rest of the flight with no data <em>or</em> music&mldr;</p><p>I finally decided I&rsquo;d had enough of it over Christmas and decided to get a Spotify subscription. I found asking Alexa to drive the Spotify skill really good, with it only once or twice ever playing something I&rsquo;d not asked for. Admittedly a lot of the intelligence in the Spotify use-case is also the search functionality in Spotify and the songs available, but just asking Alexa to play a song a fancied listening to was a lot more user-friendly than unlocking my phone, opening Spotify, opening search and then typing in what I wanted and clicking on it. I liked the experience of it so much overall I decided to treat myself to a full-sized Echo after Christmas, so now I have an Echo in the living room and the Echo Dot in my bedroom.</p><p>I started getting into a routine of asking it about the weather in the morning as I was getting up to find out whether I&rsquo;d need to dress for wet and/or cold weather. I&rsquo;d also find myself asking it what was going on with the District Line as I use it to get to the office. Such a request would always result in puzzled response from Alexa as it couldn&rsquo;t find the answer. At this point as I&rsquo;d not had the Echo for long either, so it hadn&rsquo;t really occurred to me to go and find a skill that would do this in the Alexa Skill Store.</p><p>That was effectively the seed for the TfL skill idea, and having the Echo and Echo Dot at home had given me the inspiration for my Hackathon project. Putting the two things together meant it was now time to dip my toe into the world of app stores&mldr;</p><h2 id=getting-started>Getting started</h2><p>At a high level, you write a &ldquo;skill&rdquo; (effectively an app) by using the <a href=https://developer.amazon.com/alexa-skills-kit title="Alexa Skills Kit documentation">Alexa Skills Kit</a> to receive JSON requests via an Alexa-enabled device (such as the Echo) and respond with JSON containing text. The Alexa-enabled device handles turning the user&rsquo;s request into the JSON request as well as converting your response text into speech for Alexa to respond to the user. The recommended way to do this is via a <a href=http://docs.aws.amazon.com/lambda/latest/dg/welcome.html title="AWS Lambda documentation">Lambda function</a> hosted in Amazon Web Services with an Alexa Custom Skill trigger.</p><p>While playing with the Alexa skill at work, I discovered two great resources for building an Alexa skill. <a href=https://github.com/alexa-js/alexa-app title="Alexa App on GitHub">Alexa App</a> and <a href=https://github.com/alexa-js/alexa-app-server title="Alexa App Server on GitHub">Alexa App Server</a>. Because of that I thought I&rsquo;d go down the same route, and code the skill in node.js using alexa-app.</p><p>The <a href=https://www.npmjs.com/package/alexa-app title="alexa-app on npm">alexa-app npm module</a> provides a nice abstraction between processing incoming request JSON via the Alexa Skills Kit AWS Lambda trigger. It provides a way to declare the intents your skill handles, as well as the utterances and slot value handling, and maps them to handler functions for processing the intent like the example below.</p><p>This effectively means your implementation boils down to some configuration code to wire things together, and then however many handlers you need for your skill&rsquo;s intents. Each handler receives a request and a response, so you can just grab any slot values you want from the request, do whatever logic you need for your skill, and then return text in the response. There&rsquo;s also helpers for returning &ldquo;cards&rdquo; for text display of your responses (or links and images) in the Alexa app.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#cf222e>function</span> <span style=color:#1f2328>(</span><span style=color:#1f2328>request</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>response</span><span style=color:#1f2328>)</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>    <span style=color:#cf222e>var</span> <span style=color:#1f2328>value</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>request</span><span style=color:#1f2328>.</span><span style=color:#1f2328>slot</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;NUMBER&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>response</span><span style=color:#1f2328>.</span><span style=color:#1f2328>say</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Your number was &#34;</span> <span style=color:#0550ae>+</span> <span style=color:#1f2328>value</span> <span style=color:#0a3069>&#34;.&#34;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p>This simple input-output pairing also allowed for easy unit testing later on, plus the API can be easily integration tested by providing full JSON Alexa requests for high-code coverage and to test intent-to-handler mappings.</p><p>For local debugging without needing to deploy code for an Alexa-enabled device to use, there&rsquo;s also the <a href=https://www.npmjs.com/package/alexa-app-server title="alexa-app-server on npm">alexa-app-server npm module</a>. This hosts the skill handler using <a href=https://expressjs.com/ title="The express website">express</a> and provides a simple web-based UI to select an intent, input any slot values, send a request and view the response JSON with. While this doesn&rsquo;t provide the speech synthesis you can get with the <em>Test</em> tab in the AWS Developer Portal for your skill, it improves the throughput speed of your local code-debug-test loop for quick tweaks and changes. It also renders the skill intent schema for you for pasting into the skill&rsquo;s interaction model in the developer portal.</p><p>With these two modules providing a great foundation to start from, it&rsquo;s now time to get the basics of the skill implemented.</p><p>For the first version I planned on two intents:</p><ol><li>Disruption on the tube, London Overground and DLR generally;</li><li>Asking about disruption on a single specific line from those covered.</li></ol><p>Getting the status of these lines is handled by integrating with the <a href=https://api.tfl.gov.uk/ title="TfL Unified API documentation">TfL Unified API</a>. It&rsquo;s a fairly comprehensive HTTP REST API that returns JSON responses for journey planning, lines, modes of transport etc. and is used to drive many of TfL&rsquo;s own applications and services. For these two skill intents I only need to use two of the API&rsquo;s resources:</p><ol><li><code>GET /Line/Mode/{modes}/Disruption</code></li><li><code>GET /Line/{id}/Status</code></li></ol><p>The first resource drives the overall disruption skill, as I just need to specify the modes I&rsquo;m interested in (tube, DLR, London Overground), and then parse the response. The second drives the status updates for a specific line. For that one I just need to map the spoken line name from a slot to a line Id. From there it&rsquo;s just a case of using the correct properties in the response document to render the text to convert to speech for Alexa to read out to the user.</p><p>Sounds simple enough for now. I coded something basic to start with so I knew that the API was being invoked and the response body was being used somehow to get a walking skeleton of an implementation. Next I needed to set up deployment to AWS Lambda to use it on my Echo Dot.</p><h2 id=continuous-deployment-using-travis-ci>Continuous Deployment using Travis CI</h2><p>As I&rsquo;ve decided to open-source the skill, that means I can use <a href=https://travis-ci.org/martincostello/alexa-london-travel title="Alexa London Travel's Continuous Deployment on Travis CI">Travis CI</a> for free to do my Continuous Integration to run my tests. Travis CI also has built-in support for deploying node.js apps to an AWS Lambda function. I&rsquo;m not using anything fancy for the JavaScript like TypeScript at the moment, so there&rsquo;s no much to the CI - it just needs to run tests in the long term, and out-of-the-box it already runs <code>npm install</code> and <code>npm test</code> for you as the standard build script.</p><p>Setting up the <a href=https://github.com/martincostello/alexa-london-travel/blob/main/.travis.yml title="My Travis CI configuration in GitHub">YAML file</a> was simple enough, but the first deployment of the lambda function did not work. It turned out this was because <a href=https://docs.travis-ci.com/user/deployment/lambda title="Travis CI Lambda deployment instructions">the documentation</a> to deploy a Lambda was out of date (I need to do a Pull Request to fix it. <strong><em>Updated 20/02/2017: <a href=https://github.com/travis-ci/docs-travis-ci-com/pull/974 title="GitHub Pull Request to update the Travis CI Lambda deployment documentation">Pull Request</a></em></strong>).</p><p>The missing bits were:</p><ul><li>The default node runtime version no longer being supported in AWS.</li><li>The default handler name being incorrectly generated.</li><li>The IAM permissions described were insufficient.</li></ul><p>The first two were easy to fix, but the third was a bit trickier. The IAM policy provided in the documentation was insufficient to allow Travis to update the Lambda function. After a bit of trial and error, I finally used the below IAM policy to get the deployment working smoothly:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;Version&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;2012-10-17&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>  <span style=color:#0550ae>&#34;Statement&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Sid&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;ListExistingRolesAndPolicies&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Effect&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Allow&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Action&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;iam:ListRolePolicies&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;iam:ListRoles&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Resource&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Sid&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;CreateAndListFunctions&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Effect&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Allow&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Action&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;lambda:CreateFunction&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;lambda:ListFunctions&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Resource&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Sid&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;DeployCode&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Effect&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Allow&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Action&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;lambda:UploadFunction&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;lambda:UpdateFunctionCode&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;lambda:UpdateFunctionConfiguration&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Resource&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;arn:aws:lambda:{region}:{account-id}:function:{function-name}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>},</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Sid&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;SetRole&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Effect&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;Allow&#34;</span><span style=color:#1f2328>,</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Action&#34;</span><span style=color:#1f2328>:</span> <span style=color:#1f2328>[</span>
</span></span><span style=display:flex><span>        <span style=color:#0a3069>&#34;iam:PassRole&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#1f2328>],</span>
</span></span><span style=display:flex><span>      <span style=color:#0550ae>&#34;Resource&#34;</span><span style=color:#1f2328>:</span> <span style=color:#0a3069>&#34;arn:aws:iam::{account-id}:role/{role-name}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>}</span>
</span></span><span style=display:flex><span>  <span style=color:#1f2328>]</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>}</span>
</span></span></code></pre></div><p><strong>Note</strong>: This policy <em>may</em> be more permissive than it strictly needs to be, but less permissive settings didn&rsquo;t seem to work. If you know what the best IAM policy for this is, let me know and I&rsquo;ll update it. Otherwise, check that the policy meets your needs before using it yourself.</p><p><em><strong>Updated 20/02/2017</strong>: The IAM policy has now been updated with the minimum permissions to deploy successfully from Travis CI.</em></p><p>Once the Lambda deployment was working, I created a <code>deploy</code> branch and set up Travis to only update the Lambda function for builds on that branch. That way I still get the CI benefit while developing on the main branch, without worrying about updating the lambda unnecessarily.</p><h2 id=quirks-of-alexas-pronunciation>Quirks of Alexa&rsquo;s pronunciation</h2><p>As I further refined the skill implementation I found that Alexa didn&rsquo;t pronounce &ldquo;DLR&rdquo; well. In theory the documentation for Alexa says that capitalised words can be spelled out, but Alexa seemed to think &ldquo;DLR&rdquo; was a word and pronounced it in an odd way. Fortunately Alexa supports something known as <a href=https://www.w3.org/TR/speech-synthesis/ title="SSML W3C recommendation">Speech Synthesis Markup Language (SSML)</a>. This allows you to use an XML-like syntax to describe metadata for how words should be pronounced.</p><p>However it wasn&rsquo;t quite that simple. The documentation allows you to <a href=https://developer.amazon.com/public/solutions/alexa/alexa-skills-kit/docs/speech-synthesis-markup-language-ssml-reference#say-as title="SSML documentation for Alexa">specify that a word should be spelled out</a> using a syntax like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#0550ae>&lt;say-as</span> <span style=color:#1f2328>interpret-as=</span><span style=color:#0a3069>&#34;spell-out&#34;</span><span style=color:#0550ae>&gt;</span>DLR<span style=color:#0550ae>&lt;/say-as&gt;</span>
</span></span></code></pre></div><p>Yet, that didn&rsquo;t work - it just made the weirdness of the pronunciation&mldr;different.</p><blockquote class=twitter-tweet data-lang=en><p lang=en dir=ltr>Before: <a href=https://t.co/CgZTmB78oX>pic.twitter.com/CgZTmB78oX</a></p>&mdash; Martin Costello (@martin_costello) <a href=https://twitter.com/martin_costello/status/827548751829094400>February 3, 2017</a></blockquote><script async src=//platform.twitter.com/widgets.js></script><p>Using the speech preview in the <em>Test</em> tab of the skill in the developer portal allowed for some trial and error though. Eventually I got it being pronounced correctly by placing dots between the letters: <code>D.L.R.</code>. This had the unintended side-effect later of making <a href=https://developer.amazon.com/public/solutions/alexa/alexa-skills-kit/docs/providing-home-cards-for-the-amazon-alexa-app title="Alexa cards documentation">cards</a> slightly more difficult to implement. This was because my modified text for the speech could no longer just be returned as-is for use in the cards as it would not look right when read. This just required some extra code to put the raw TfL API text responses into the cards, and then post-process them to adjust the pronunciation.</p><h2 id=getting-through-the-certification-process>Getting through the certification process</h2><p>Once I was happy with the implementation of my skill through testing the lambda myself by speaking to the skill installed on my Echo Dot, I submitted it for certification. Ultimately it took three submissions to get through the skill certification process tests, with each attempt taking approximately 48 hours to get the results via email after being submitted. The failures were a mixture of bugs, mistakes, not reading the test cases properly in advance, and my graphic design skills. Below is a summary of what failed and how I fixed it.</p><h3 id=attempt-1>Attempt 1</h3><ol><li><a href=https://github.com/martincostello/alexa-london-travel/issues/12>An intent that didn&rsquo;t work</a> - I&rsquo;d initially had a third &ldquo;test&rdquo; intent for checking connectivity to the TfL API that I used when initially deploying the lambda function. I&rsquo;d removed this before certification, but forgotten to remove it from the skill&rsquo;s intent schema. The certification process seems to involve a lot of automated tests, and as the tests read the schema, they failed the intent as &ldquo;unresponsive&rdquo;. This was easily fixed by correcting the skill schema.</li><li><a href=https://github.com/martincostello/alexa-london-travel/issues/13>Incorrect utterances</a> - I&rsquo;d added some sample utterances to the skill metadata in the developer portal, but they weren&rsquo;t in the utterance list specified in the interaction model. Again, this was easy to correct.</li><li><a href=https://github.com/martincostello/alexa-london-travel/issues/15>Not launching correctly</a> - If the skill was launched with no intent (for example, &ldquo;<em>Alexa, open London Travel</em>&rdquo;), the skill would just play a greeting and then exit. This meant that all utterances had to start with &ldquo;<em>Alexa ask London Travel&mldr;</em>&rdquo;, which is not an optimum user experience. This just needed a <a href=https://github.com/martincostello/alexa-london-travel/commit/9daba4a52daeedb23472fbb3ea27fa5feb1d24ca title="the fix">one-line tweak</a> to the response to not end the session.</li><li><a href=https://github.com/martincostello/alexa-london-travel/issues/14>An unclear icon</a> - My graphic design skills are effectively non-existent, so I just made a 4x4 grid of square coloured according to the colours used by TfL for the lines supported by the skill. The icon I designed was initially rejected as &ldquo;unclear or misleading&rdquo; but without any specific detail about that. As I wasn&rsquo;t confident on designing a new icon without knowing what was wrong with the old one, I queried this with the certification team, explaining the symbolism. Eventually I received a reply saying the icon was fine. I wonder if it was initially rejected because it evokes memories of <a href=http://www.andersenpress.co.uk/elmer/ title="Elmer the elephant's website">Elmer the elephant</a> as some people pointed out to me after I&rsquo;d made it&mldr;</li></ol><h3 id=attempt-2>Attempt 2</h3><ol><li><a href=https://github.com/martincostello/alexa-london-travel/issues/16>Not responding to &ldquo;<em>help</em>&rdquo;</a> - The skill had no functionality to ask it for help, which was easily added by handling the built-in <code>AMAZON.HelpIntent</code> intent.</li><li><a href=https://github.com/martincostello/alexa-london-travel/issues/17>Not responding to &ldquo;<em>cancel</em>&rdquo; or &ldquo;<em>stop</em>&rdquo;</a> - The incorrect launch functionality in the previous submission had hidden that the skill could not be asked to stop or cancel if it was idle. This was also fixed by using the built-in <code>AMAZON.CancelIntent</code> and <code>AMAZON.StopIntent</code> intents. Initially I thought these were handled as the same intent, until discovering they were distinct during testing with the Echo Dot.</li></ol><h3 id=attempt-3>Attempt 3</h3><p>Certified and made available on <a href=https://www.amazon.co.uk/dp/B01NB0T86R title="London Travel on amazon.co.uk">amazon.co.uk</a>!</p><h2 id=monitoring-in-production>Monitoring in production</h2><p>Once the skill was published to the Alexa Skill store, I found that on the second morning the skill would not respond when I invoked it. The blue ring on my Echo Dot would spin for 3 seconds and then Alexa would tell me the skill had failed to respond correctly. The lambda appeared to have &ldquo;gone to sleep&rdquo; from not being used overnight, and as it was taking more than 3 seconds to start-up (the default response timeout), the requests were all failing.</p><p>I resolved the &ldquo;keeping the skill warm&rdquo; (or at least I thought I did) by setting up a <a href=http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html title="CloudWatch events documentation">CloudWatch Event</a> to make a request to the lambda function to launch the skill every 5 minutes. I then set up CloudWatch alarms to watch for errors, throttled requests, and requests that took too long.</p><p>The &ldquo;keep it warm event&rdquo; doesn&rsquo;t seem to fully solve the laggy responses though, as two days later I had the same problem again despite no CloudWatch alarms having gone off. I&rsquo;ve worked around this for now by changing the maximum lambda request timeout to 10 seconds. This gives the function plenty of time to start-up if it does &ldquo;go cold&rdquo;. I need to do further research into finding out why the event isn&rsquo;t enough to keep the function warm.</p><h2 id=wrapping-up>Wrapping up</h2><p>In a future version I might look into enabling Amazon account-linking to allow users to use a companion website to save their favourite lines to allow for a personalised commute status, as well as some further &ldquo;speech massage&rdquo; of the responses from TFL. For example, the acronym &ldquo;<em>SWT</em>&rdquo; for &ldquo;<em>South West Trains</em>&rdquo; sounds a bit weird when it appears in statuses. Feature requests and bug reports are gratefully accepted on <a href=https://github.com/martincostello/alexa-london-travel/issues title="Alexa London Travel issues on GitHub">GitHub</a>.</p><p>That&rsquo;s about it really. All-in-all it took a couple of days of effort and about three weeks of elapsed time to go from the first commit to a published skill, mostly done on days off. It was fun to work on, and has given me a bit of experience playing with not only Alexa, but AWS Lambda and node.js.</p><p>I hope you&rsquo;ve found this post interesting or useful. If you&rsquo;ve read this far, how about installing the skill or leaving a review on <a href=https://www.amazon.co.uk/dp/B01NB0T86R title>amazon.co.uk</a>? :)</p><hr><p><div class=row><div class=col-lg-6><a href="https://bsky.app/intent/compose?text=Publishing+My+First+Alexa+Skill+by+%40martincostello.com+-+https%3A%2F%2Fblog.martincostello.com%2Fpublishing-my-first-alexa-skill%2F" target=_blank rel=noopener class="btn btn-info btn-sm" title="Share on Bluesky">Share on Bluesky
<span class="fa-brands fa-bluesky" aria-hidden=true></span></a></div></div></p><hr><footer><p><div class=row><div class="d-none d-md-block col">&copy; Martin Costello 2014-2025 |
Built from <a href=https://github.com/martincostello/blog/commit/1e081eee55dfb7b252dce3b0ab73a36513d14253 rel=noopener title="View commit 1e081eee55dfb7b252dce3b0ab73a36513d14253 on GitHub">1e081ee</a> on <a href=https://github.com/martincostello/blog/tree/copilot/fix-244 rel=noopener title="View branch copilot/fix-244 on GitHub">copilot/fix-244</a></div><div class=d-md-none><div class=col>&copy; Martin Costello 2014-2025</div></div></div></p></footer></main><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.7/flatly/bootstrap.min.css integrity="sha512-O+EA0Agf5+pB8u7CtnIAYq/BKyFPMT8c0DFjmqLyfIJJ9Fm8GBohV/0H0TFaZ96+jieN8zUVY4IkSBso9z6hpg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer async><link rel=stylesheet href=/styles/site.css><script src=https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.bundle.min.js integrity="sha512-Tc0i+vRogmX4NN7tuLbQfBxa8JkfUSAxSFVzmU31nVdHyiHElPPy2cWfFacmCJKw0VqovrzKhdd2TSTMdAxp2g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src="https://www.googletagmanager.com/gtag/js?id=G-XJFV74HRL6" async></script><script>window.hugoSiteParams={render_analytics:!0,analytics_id:"G-XJFV74HRL6"}</script><script src=/scripts/site.js defer></script></body></html>